# Соглашения разработки

> Полное техническое видение смотри в @vision.md

## Утилиты и инструменты

**Обязательные:**
- **Python 3.11+** - основной язык
- **uv** - управление зависимостями и окружением  
- **make** - автоматизация команд
- **Docker** - контейнеризация

**Основной стек (см. @vision.md раздел 1):**
- `aiogram` - Telegram Bot API
- `openrouter` через `openai` client - LLM
- `pytest` - тестирование

## Основные принципы разработки

1. **KISS** - максимальная простота решений
2. **Функциональное программирование** - только функции, никакого ООП
3. **Единственная ответственность** - один модуль = одна задача
4. **MVP подход** - сначала работающая версия, потом улучшения

> Детали принципов: @vision.md раздел 2

## Стиль кода

**Организация:**
- Один файл = одна ответственность
- Функции вместо классов
- Внешние ресурсы (промпты) в отдельных файлах
- Логирование только в stdout

**Именование:**
- Описательные имена функций и переменнных  
- Файлы: `snake_case.py`
- Константы: `UPPER_CASE`

## Структура проекта

**Строго следовать структуре из @vision.md раздел 3:**
```
src/bot/       # Telegram логика
src/llm/       # LLM интеграция  
src/memory/    # История диалогов
src/config/    # Настройки
prompts/       # Системные промпты
tests/         # Зеркало src/
```

**Принципы:**
- Каждая папка = одна область ответственности
- Тесты повторяют структуру `src/`
- Конфигурационные файлы в корне проекта

## Работа с зависимостями

**Управление:**
- `pyproject.toml` - единственный файл конфигурации
- `uv sync` - установка зависимостей
- `uv run` - запуск команд

**Принципы:**
- Минимум внешних зависимостей
- Использовать стабильные версии
- Указывать версии в `pyproject.toml`

## Обработка ошибок

**Пользовательские ошибки:**
- Дружелюбные сообщения без технических деталей
- Graceful degradation - система работает при частичных сбоях

**Системные ошибки:**  
- Логирование в stdout для Docker
- Retry-логика для API (3 попытки)
- Fallback механизмы (резервная LLM модель)

> Детали: @vision.md раздел 2.3

## Конфигурация

**Переменные окружения:**
- `.env` файл для локальной разработки
- Railway Variables для продакшена
- Валидация при запуске

**Структура:**
- Обязательные: `TELEGRAM_BOT_TOKEN`, `OPENROUTER_API_KEY`
- Настраиваемые: модели, лимиты, таймауты
- Значения по умолчанию для необязательных

> Полный список: @vision.md раздел 10

## Тестирование

**Структура:**
- `tests/` зеркалирует `src/`
- `test_bot/`, `test_llm/`, `test_memory/`

**Команды:**
- `make test` - запуск тестов
- `pytest` через `uv run`

**Что тестировать:**
- Логику обработки сообщений  
- Интеграцию с LLM
- Управление памятью
- Конфигурационные настройки

---

> **Главное правило:** Любое решение должно быть максимально простым и понятным. При сомнениях выбирай более простой вариант.
